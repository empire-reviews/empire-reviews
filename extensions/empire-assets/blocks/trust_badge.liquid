{% schema %}
{
  "name": "Trust Badge",
  "target": "section",
  "stylesheet": "empire.css",
  "settings": [
    { "type": "header", "content": "Badge Style" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#111111" },
    { "type": "color", "id": "star_color", "label": "Star Color", "default": "#fbbf24" },
    { "type": "range", "id": "font_size", "min": 12, "max": 24, "step": 1, "unit": "px", "label": "Font Size", "default": 14 },
    { "type": "select", "id": "alignment", "label": "Alignment", "options": [
        { "value": "flex-start", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Right" }
    ], "default": "center" },
    { "type": "header", "content": "Dynamic Ticker Messages" },
    { "type": "paragraph", "content": "Leave messages blank to disable them. If only 1 is set, it will be static." },
    { "type": "text", "id": "message_1", "label": "Message 1 (Default)", "default": "Verified Reviews" },
    { "type": "text", "id": "message_2", "label": "Message 2", "default": "Free Shipping Worldwide" },
    { "type": "text", "id": "message_3", "label": "Message 3", "default": "30-Day Guarantee" }
  ]
}
{% endschema %}

<div class="empire-trust-strip" data-empire-trust data-shop="{{ shop.permanent_domain }}" style="justify-content: {{ block.settings.alignment }};">
  
  <!-- Pulsing Icon -->
  <div class="empire-trust-icon-wrapper">
      <div class="empire-trust-icon">
        <svg viewBox="0 0 24 24" fill="none" class="empire-shield" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        <path d="M9 12l2 2 4-4" /> 
        </svg>
      </div>
      <div class="empire-pulse-ring"></div>
  </div>

  <div class="empire-trust-content">
    
    <!-- Ticker Container -->
    <div class="empire-ticker-container">
        
        <!-- Message 1: Reviews -->
        <div class="empire-ticker-item item-1">
            <span class="empire-trust-title">{{ block.settings.message_1 }}</span>
            <span class="empire-trust-divider">|</span>
            <div class="empire-trust-stars">
            {% for i in (1..5) %}
                <svg class="empire-star-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
            {% endfor %}
            </div>
            <span class="empire-trust-score">4.9/5</span>
        </div>

        <!-- Message 2 -->
        {% if block.settings.message_2 != blank %}
        <div class="empire-ticker-item item-2">
            <span class="empire-trust-title">{{ block.settings.message_2 }}</span>
            <span class="empire-trust-divider">|</span>
            <span class="empire-trust-extra">üî• Selling Fast</span>
        </div>
        {% endif %}

        <!-- Message 3 -->
        {% if block.settings.message_3 != blank %}
        <div class="empire-ticker-item item-3">
            <span class="empire-trust-title">{{ block.settings.message_3 }}</span>
            <span class="empire-trust-divider">|</span>
            <span class="empire-trust-extra">üõ°Ô∏è Secure Checkout</span>
        </div>
        {% endif %}

    </div>
  </div>
</div>

<style>
  .empire-trust-strip {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    font-family: inherit;
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.font_size }}px;
    width: 100%;
    overflow: hidden; /* Mask ticker */
  }

  /* Icon & Pulse */
  .empire-trust-icon-wrapper { position: relative; width: 28px; height: 28px; flex-shrink: 0; }
  
  .empire-trust-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    background: {{ block.settings.text_color }};
    color: #fff;
    border-radius: 50%;
    width: 100%;
    height: 100%;
    position: relative;
    z-index: 2;
  }
  
  .empire-pulse-ring {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      border-radius: 50%;
      border: 1px solid {{ block.settings.text_color }};
      animation: empire-pulse 2s infinite;
      z-index: 1;
      opacity: 0;
  }

  @keyframes empire-pulse {
      0% { transform: scale(1); opacity: 0.6; }
      100% { transform: scale(1.6); opacity: 0; }
  }

  .empire-shield { width: 14px; height: 14px; }
  
  /* Ticker Layout */
  .empire-trust-content {
    flex: 1;
    height: 1.4em; /* Fixed height for ticker line */
    position: relative;
    overflow: hidden;
  }

  .empire-ticker-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: {{ block.settings.alignment }}; /* Push items to align */
  }

  .empire-ticker-item {
    display: flex;
    align-items: center;
    justify-content: {{ block.settings.alignment }}; /* Align internal content */
    gap: 8px;
    white-space: nowrap;
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transform: translateY(10px);
    animation: empire-slide-fade 9s infinite; /* 3 items x 3s each */
  }

  /* Stagger Animations */
  .item-1 { animation-delay: 0s; }
  .item-2 { animation-delay: 3s; }
  .item-3 { animation-delay: 6s; }

  /* Only run animation if we have multiple items, else simple static */
  {% if block.settings.message_2 == blank and block.settings.message_3 == blank %}
    .empire-ticker-item { animation: none; opacity: 1; transform: translateY(0); }
  {% endif %}

  @keyframes empire-slide-fade {
      0% { opacity: 0; transform: translateY(10px); }
      5% { opacity: 1; transform: translateY(0); }
      30% { opacity: 1; transform: translateY(0); } /* Stay visible */
      35% { opacity: 0; transform: translateY(-10px); } /* Exit up */
      100% { opacity: 0; transform: translateY(-10px); }
  }

  .empire-trust-title {
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.9em;
  }

  .empire-trust-divider { opacity: 0.2; margin: 0 4px; }
  .empire-trust-extra { font-size: 0.85em; opacity: 0.8; font-weight: 500; }

  .empire-trust-stars {
    display: flex;
    align-items: center;
    color: {{ block.settings.star_color }};
    line-height: 0;
  }

  .empire-star-icon { width: 1.1em; height: 1.1em; }

  .empire-trust-score {
    font-weight: 600;
    opacity: 0.7;
    margin-left: 4px;
    font-size: 0.9em;
  }
</style>
