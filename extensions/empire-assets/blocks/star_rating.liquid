{% schema %}
{
  "name": "Star Rating",
  "target": "section",
  "stylesheet": "empire.css",
  "settings": [
    { "type": "header", "content": "Visual Style" },
    { "type": "color", "id": "color", "label": "Star Color", "default": "#fbbf24" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#6b7280" },
    { "type": "range", "id": "size", "min": 16, "max": 80, "step": 1, "unit": "px", "label": "Star Size", "default": 24 },
    { "type": "range", "id": "text_size", "min": 10, "max": 40, "step": 1, "unit": "px", "label": "Text Size", "default": 14 },
    { "type": "select", "id": "alignment", "label": "Alignment", "options": [
        { "value": "flex-start", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Right" }
    ], "default": "flex-start" },
    { "type": "header", "content": "Social Proof" },
    { "type": "checkbox", "id": "show_count", "label": "Show Review Count", "default": true },
    { "type": "text", "id": "count_text", "label": "Text Format", "default": "({n} reviews)" }
  ]
}
{% endschema %}

<div class="empire-star-rating" 
     data-product-id="{{ product.id }}" 
     data-show-count="{{ block.settings.show_count }}"
     data-count-text="{{ block.settings.count_text }}"
     data-design-mode="{{ request.design_mode }}"
     data-text-color="{{ block.settings.text_color }}"
     data-star-size="{{ block.settings.size }}"
     data-text-size="{{ block.settings.text_size }}"
     style="justify-content: {{ block.settings.alignment }};"
>
  <!-- Initial Load: SVG Stars (Server Side Rendered for Editor) -->
  <span class="empire-stars-loading" style="display: flex; gap: 2px;">
    {% for i in (1..5) %}
      <!-- Directly applying fill color from settings to ensuring it works -->
      <svg viewBox="0 0 24 24" width="{{ block.settings.size }}" height="{{ block.settings.size }}" fill="{{ block.settings.color }}">
         <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
      </svg>
    {% endfor %}
  </span>
  
  <!-- Editor Preview Text: Always show if enabled in editor -->
  {%- if request.design_mode and block.settings.show_count -%}
    <span class="empire-rating-count" style="margin-left: 8px; font-size: 0.9em; opacity: 0.8; color: {{ block.settings.text_color }};">
      {% assign pattern = "{n}" %}
      {{ block.settings.count_text | replace: pattern, '100' }} (Preview)
    </span>
  {%- endif -%}
</div>

<script src="{{ 'empire_v2.js' | asset_url }}" defer></script>
